import{r as h,u as X,j as e,L as P,F as De,e as Te,V as u,f as M,h as ee,k as I,l as Be,m as be,n as ie,o as Oe,p as Re,q as oe,s as ce,t as me,v as qe,w as Me,x as ze,y as fe,z as Le,A as ye,B as Ie,C as Ve,D as Ue,E as Ge,G as Ke,H as Je,R as ne,I as ue,J as Qe,N as je,K as Ye,M as He,O as q,Q as Xe,S as Ze,T as We}from"./react-vendor-EoCnjIE4.js";import{k as ea,l as K,n as _,o as de,q as G,C as we,t as ve,v as Ne,w as ke,x as Ce,y as Se,z as Ee,D as aa,E as S,F as _e,R as ta,G as ra,H as sa,X as oa,Y as na,T as ia,I as da,J as xe,K as la,M as ca,N as ma}from"./vendor-DmyU9SCa.js";import{b as ua}from"./tanstack-vendor-CLvyKzMT.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();const xa="https://boliimdzupauzqpznari.supabase.co",ha="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJvbGlpbWR6dXBhdXpxcHpuYXJpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxOTcyMzYsImV4cCI6MjA2ODc3MzIzNn0.2txtK0RivPun8AoWriPO-6dOE4wnxj1MLu_0FPs5L4o",E=ea(xa,ha),Fe=h.createContext(void 0),z=()=>{const a=h.useContext(Fe);if(a===void 0)throw new Error("useAuth must be used within an AuthProvider");return a},ga=(a,s)=>{if(!a.length){console.warn("No data to export.");return}const i=Object.keys(a[0]),n=[i.join(","),...a.map(d=>i.map(g=>JSON.stringify(d[g])).join(","))].join(`
`),r=new Blob([n],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");if(o.download!==void 0){const d=URL.createObjectURL(r);o.setAttribute("href",d),o.setAttribute("download",s),o.style.visibility="hidden",document.body.appendChild(o),o.click(),document.body.removeChild(o)}},Ae=h.createContext(void 0),le=()=>{const a=h.useContext(Ae);if(a===void 0)throw new Error("useTheme must be used within a ThemeProvider");return a},pa=()=>{const{theme:a,toggleTheme:s}=le(),i=X(),n=async()=>{const{error:r}=await E.auth.signOut();r?u.error("Erro ao sair."):(u.success("Você saiu da sua conta."),i("/login"))};return e.jsxs("header",{className:"bg-white dark:bg-gray-800 p-4 shadow-md flex justify-between items-center",children:[e.jsx(P,{to:"/",className:"text-2xl font-bold text-cyan-500",children:"Nós Dois"}),e.jsx("nav",{children:e.jsxs("ul",{className:"flex space-x-6 items-center",children:[e.jsx("li",{children:e.jsx(P,{to:"/dashboard",className:"relative text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:h-[2px] after:w-[40px] after:bg-[#00f7ff] after:origin-center after:scale-x-0 after:transition-transform after:duration-300 hover:after:scale-x-100",children:"Dashboard"})}),e.jsx("li",{children:e.jsx(P,{to:"/personal-goals",className:"relative text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:h-[2px] after:w-[40px] after:bg-[#00f7ff] after:origin-center after:scale-x-0 after:transition-transform after:duration-300 hover:after:scale-x-100",children:"Metas Pessoais"})}),e.jsx("li",{children:e.jsx(P,{to:"/scheduled-transactions",className:"relative text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:h-[2px] after:w-[40px] after:bg-[#00f7ff] after:origin-center after:scale-x-0 after:transition-transform after:duration-300 hover:after:scale-x-100",children:"Agendadas"})}),e.jsx("li",{children:e.jsx(P,{to:"/profile",className:"relative text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:h-[2px] after:w-[40px] after:bg-[#00f7ff] after:origin-center after:scale-x-0 after:transition-transform after:duration-300 hover:after:scale-x-100",children:"Perfil"})}),e.jsx("li",{children:e.jsx(P,{to:"/couple-dashboard",className:"relative text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors duration-300 after:content-[''] after:absolute after:bottom-0 after:left-1/2 after:-translate-x-1/2 after:h-[2px] after:w-[40px] after:bg-[#00f7ff] after:origin-center after:scale-x-0 after:transition-transform after:duration-300 hover:after:scale-x-100",children:"Dashboard Casal"})}),e.jsx("li",{children:e.jsx("button",{onClick:s,className:"p-2 rounded-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-300","aria-label":"Toggle theme",children:a==="dark"?e.jsx(De,{className:"h-6 w-6 text-yellow-400"}):e.jsx(Te,{className:"h-6 w-6 text-gray-800"})})}),e.jsx("li",{children:e.jsx("button",{onClick:n,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300",children:"Sair"})})]})})]})},F=({children:a})=>{const{theme:s}=le();return e.jsxs("div",{className:`min-h-screen flex flex-col relative ${s}`,children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden z-0",children:[e.jsx("div",{className:"absolute w-96 h-96 top-1/4 left-1/4 border border-gray-300 dark:border-gray-700 opacity-20 rounded-full"}),e.jsx("div",{className:"absolute w-80 h-80 top-3/4 left-1/3 border border-gray-300 dark:border-gray-700 opacity-20 rounded-full"}),e.jsx("div",{className:"absolute w-100 h-100 top-1/2 right-1/4 border border-gray-300 dark:border-gray-700 opacity-20 rounded-full"})]}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white flex-grow relative z-10",children:[e.jsx(pa,{}),e.jsx("main",{className:"flex-grow",children:a})]})]})},W=({title:a,isOpen:s,onClose:i,children:n})=>s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-full max-w-md mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:a}),e.jsx("button",{onClick:i,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"×"})]}),e.jsx("div",{children:n})]})}):null,ba=K().shape({category_id:_().uuid("Selecione uma categoria válida").required("Categoria é obrigatória"),amount:de().positive("O valor da meta deve ser positivo").required("Valor é obrigatório"),month:_().matches(/^\d{4}-\d{2}$/,"Mês inválido (YYYY-MM)").required("Mês é obrigatório")}),fa=({categories:a,onGoalCreated:s})=>{const{session:i}=z(),n="http://localhost:3001",r=M({mutationFn:async d=>{if(!i)throw new Error("Autenticação necessária.");const g=await fetch(`${n}/api/goals`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify({...d,month:`${d.month}-01`})});if(!g.ok){const l=await g.json();throw new Error(l.error||"Não foi possível adicionar a meta mensal.")}return g.json()},onSuccess:()=>{u.success("Meta mensal adicionada com sucesso!"),s()},onError:d=>{u.error(`Erro: ${d.message}`)}}),o=G({initialValues:{category_id:"",amount:"",month:new Date().toISOString().substring(0,7)},validationSchema:ba,onSubmit:d=>{r.mutate({category_id:d.category_id,amount:parseFloat(d.amount),month:d.month})}});return e.jsxs("form",{onSubmit:o.handleSubmit,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"Categoria"}),e.jsxs("select",{id:"category_id",name:"category_id",onChange:o.handleChange,onBlur:o.handleBlur,value:o.values.category_id,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:text-white",children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),a.map(d=>e.jsx("option",{value:d.id,children:d.name},d.id))]}),o.touched.category_id&&o.errors.category_id&&e.jsx("p",{className:"text-red-500 text-xs italic",children:o.errors.category_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"Valor da Meta"}),e.jsx("input",{type:"number",id:"amount",name:"amount",onChange:o.handleChange,onBlur:o.handleBlur,value:o.values.amount,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:text-white",placeholder:"Ex: 500.00"}),o.touched.amount&&o.errors.amount&&e.jsx("p",{className:"text-red-500 text-xs italic",children:o.errors.amount})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"month",className:"block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2",children:"Mês (YYYY-MM)"}),e.jsx("input",{type:"month",id:"month",name:"month",onChange:o.handleChange,onBlur:o.handleBlur,value:o.values.month,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline dark:bg-gray-700 dark:text-white"}),o.touched.month&&o.errors.month&&e.jsx("p",{className:"text-red-500 text-xs italic",children:o.errors.month})]}),e.jsx("button",{type:"submit",className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline disabled:opacity-50",disabled:r.isPending,children:r.isPending?"Adicionando...":"Adicionar Meta"})]})};we.register(ve,Ne,ke,Ce,Se,Ee,aa);const J=a=>`R$ ${a.toFixed(2).replace(".",",")}`,ya=async a=>{const{data:s,error:i}=await E.from("transactions").select("*, categories(name)").eq("user_id",a);if(i)throw i;return s||[]},ja=async(a,s)=>{const i=`${s}-01`,{data:n,error:r}=await E.from("goals").select("*").eq("user_id",a).eq("month",i);if(r)throw r;return n||[]},wa=async()=>{const{data:a,error:s}=await E.from("categories").select("id, name");if(s)throw s;return a||[]},va=()=>{const{user:a,session:s}=z(),i=ee(),[n,r]=h.useState(!1),{data:o=[],isLoading:d,error:g}=I({queryKey:["transactions",a?.id],queryFn:()=>ya(a.id),enabled:!!a?.id}),{data:l=[],isLoading:p,error:y}=I({queryKey:["goals",a?.id,new Date().toISOString().substring(0,7)],queryFn:()=>ja(a.id,new Date().toISOString().substring(0,7)),enabled:!!a?.id}),{data:b=[],isLoading:j,error:v}=I({queryKey:["categories"],queryFn:wa}),{data:N,isLoading:D,error:T}=I({queryKey:["coupleData",a?.id],queryFn:async()=>{if(!s)throw new Error("Autenticação necessária.");const t=await fetch("http://localhost:3001/api/couple-dashboard",{headers:{Authorization:`Bearer ${s.access_token}`}});if(!t.ok){const w=await t.text();throw new Error(`Failed to fetch couple data: ${t.status} ${t.statusText} - ${w}`)}const c=t.headers.get("content-type");if(!c||!c.includes("application/json")){const w=await t.text();throw new Error(`Expected JSON response, but received ${c||"no content type"}: ${w}`)}return t.json()},enabled:!!s&&!!a?.id}),O=d||p||j||D,B=g||y||v||T;if(O)return e.jsx(F,{children:e.jsx("div",{className:"w-full h-screen flex items-center justify-center",children:"Carregando dashboard..."})});if(B)return e.jsx(F,{children:e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar dados: ",B.message]})});const R=o.filter(t=>t.type==="income").reduce((t,c)=>t+c.amount,0),L=o.filter(t=>t.type==="expense").reduce((t,c)=>t+c.amount,0),$=R-L,C=o.filter(t=>t.type==="expense").reduce((t,c)=>{const w=c.categories?.name||"Uncategorized";return t[w]=(t[w]||0)+c.amount,t},{}),m={labels:Object.keys(C),datasets:[{label:"Expenses by Category",data:Object.values(C),backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},A=l.map(t=>{const c=b.find(k=>k.id===t.category_id)?.name||"Uncategorized",w=C[c]||0,x=w/t.amount*100;return{...t,spent:w,progress:x,categoryName:c}}),f=()=>{const t=o.map(c=>({id:c.id,type:c.type,amount:c.amount,category:c.categories?.name||"Uncategorized",date:c.date}));ga(t,"transactions.csv")};return e.jsxs(F,{children:[e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Dashboard Pessoal"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Visão geral das suas finanças."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(P,{to:"/nova-transacao",children:e.jsx("button",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors shadow-md",children:"+ Adicionar Nova Transação"})}),e.jsx("button",{onClick:f,className:"bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition-colors shadow-md",children:"Exportar para CSV"}),e.jsx("button",{onClick:()=>r(!0),className:"bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors shadow-md",children:"+ Adicionar Meta Mensal"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-500",children:"Receita Total"}),e.jsx("p",{className:"text-3xl font-bold text-green-500 my-2",children:J(R)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-500",children:"Despesa Total"}),e.jsx("p",{className:"text-3xl font-bold text-red-500 my-2",children:J(L)})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-500",children:"Saldo Atual"}),e.jsx("p",{className:`text-3xl font-bold my-2 ${$>=0?"text-green-500":"text-red-500"}`,children:J($)})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md h-[400px]",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Despesas por Categoria"}),Object.keys(C).length>0?e.jsx(Be,{data:m}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhuma despesa por categoria encontrada."})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Progresso das Metas"}),A.length>0?A.map(t=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:t.categoryName}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-400",children:[J(t.spent)," / ",J(t.amount)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 dark:bg-gray-700",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full",style:{width:`${Math.min(100,t.progress)}%`}})})]},t.id)):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhuma meta encontrada."})})]})]}),N&&e.jsxs("div",{className:"mt-8 p-4 bg-white rounded-lg shadow-md",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"Dashboard do Casal"}),N.transactions.length>0?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-green-100 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Receita Total do Casal"}),e.jsx("p",{className:"text-2xl text-green-700",children:J(N.transactions.filter(t=>t.type==="income").reduce((t,c)=>t+c.amount,0))})]}),e.jsxs("div",{className:"bg-red-100 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Despesa Total do Casal"}),e.jsx("p",{className:"text-2xl text-red-700",children:J(N.transactions.filter(t=>t.type==="expense").reduce((t,c)=>t+c.amount,0))})]}),e.jsxs("div",{className:"bg-blue-100 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Saldo do Casal"}),e.jsx("p",{className:"text-2xl text-blue-700",children:J(N.transactions.filter(t=>t.type==="income").reduce((t,c)=>t+c.amount,0)-N.transactions.filter(t=>t.type==="expense").reduce((t,c)=>t+c.amount,0))})]})]})}):e.jsx("p",{className:"text-center text-gray-500",children:"Nenhuma transação do casal encontrada."}),N.goals.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Metas do Casal"}),e.jsxs("p",{className:"text-gray-600",children:["Total de metas do casal: ",N.goals.length]})]})]}),!N&&e.jsx("div",{className:"mt-8 p-4 bg-gray-100 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-600",children:"Conecte-se com um parceiro para ver o Dashboard do Casal."})})]}),n&&e.jsx(W,{title:"Adicionar Meta Mensal",isOpen:n,onClose:()=>r(!1),children:e.jsx(fa,{categories:b,onGoalCreated:()=>{r(!1),i.invalidateQueries({queryKey:["goals"]})}})})]})},Na=K().shape({type:_().oneOf(["income","expense"]).required("O tipo é obrigatório"),amount:de().positive("O valor deve ser positivo").required("O valor é obrigatório"),category_id:_().uuid("Selecione uma categoria válida").required("A categoria é obrigatória"),description:_().optional(),date:_().required("A data é obrigatória")});function ka(){const a="http://localhost:3001",s=X(),{session:i}=z(),n=ee(),r=G({initialValues:{type:"expense",amount:0,category_id:"",description:"",date:new Date().toISOString().split("T")[0]},validationSchema:Na,onSubmit:p=>{const y={...p,type:p.type};console.log("Submitting values:",y),l.mutate(y)}});h.useEffect(()=>{i||(u.error("Acesso negado. Faça login para criar uma transação."),s("/login"))},[i,s]);const{data:o,isLoading:d,error:g}=I({queryKey:["categories"],queryFn:async()=>{if(!i)return[];const p=await fetch(`${a}/api/categories`,{headers:{Authorization:`Bearer ${i.access_token}`}});if(!p.ok)throw new Error("Não foi possível buscar as categorias.");return p.json()},enabled:!!i}),l=M({mutationFn:async p=>{if(!i)throw new Error("Autenticação necessária.");const y=await fetch(`${a}/api/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(p)});if(!y.ok){const b=await y.json();throw new Error(b.error||"Não foi possível salvar a transação.")}return y.json()},onSuccess:p=>{const y=new Date(p.date),b=new Date;b.setHours(0,0,0,0),y>b?(u.success("Transação agendada com sucesso!"),n.invalidateQueries({queryKey:["scheduledTransactions"]})):(u.success("Transação salva com sucesso!"),n.invalidateQueries({queryKey:["transactions"]})),s("/dashboard")},onError:p=>{u.error(`Erro ao salvar a transação: ${p.message}`)}});return e.jsx(F,{children:e.jsx("div",{className:"max-w-2xl mx-auto p-4 sm:p-6 lg:p-8",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-6",children:"Criar Nova Transação"}),e.jsxs("form",{onSubmit:r.handleSubmit,noValidate:!0,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tipo"}),e.jsxs("select",{id:"type",...r.getFieldProps("type"),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"expense",children:"Saída"}),e.jsx("option",{value:"income",children:"Entrada"})]}),r.touched.type&&r.errors.type&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.errors.type})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Valor (R$)"}),e.jsx("input",{type:"number",id:"amount",...r.getFieldProps("amount"),step:"0.01",className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",placeholder:"150,00"}),r.touched.amount&&r.errors.amount&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.errors.amount})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Categoria"}),e.jsx("select",{id:"category_id",...r.getFieldProps("category_id"),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",disabled:d||!!g,children:d?e.jsx("option",{children:"Carregando categorias..."}):g?e.jsx("option",{children:"Erro ao carregar categorias"}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),o?.map(p=>e.jsx("option",{value:p.id,children:p.name},p.id))]})}),r.touched.category_id&&r.errors.category_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.errors.category_id})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Descrição (Opcional)"}),e.jsx("textarea",{id:"description",...r.getFieldProps("description"),rows:3,className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500",placeholder:"Ex: Compras do mês no supermercado"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data"}),e.jsx("input",{type:"date",id:"date",...r.getFieldProps("date"),className:"w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200 focus:ring-2 focus:ring-blue-500"}),r.touched.date&&r.errors.date&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.errors.date})]}),e.jsxs("div",{className:"flex items-center justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:l.isPending,className:"py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:bg-blue-400 disabled:cursor-not-allowed",children:l.isPending?"Salvando...":"Salvar Transação"})]})]})]})})})}const ae="http://localhost:3001",he=a=>`R$ ${a.toFixed(2).replace(".",",")}`;function Ca(){const{session:a}=z(),s=ee(),[i,n]=h.useState({name:"",target_amount:"0"}),[r,o]=h.useState({}),[d,g]=h.useState({amount:"0"}),[l,p]=h.useState({}),[y,b]=h.useState(!1),[j,v]=h.useState(!1),[N,D]=h.useState(null),T=x=>{const{id:k,value:V}=x.target;n(U=>({...U,[k]:k==="target_amount"?parseFloat(V):V})),o(U=>({...U,[k]:void 0}))},O=x=>{const{id:k,value:V}=x.target;g(U=>({...U,[k]:parseFloat(V)})),p(U=>({...U,[k]:void 0}))},B=()=>{const x={},k=parseFloat(i.target_amount);return i.name.trim()||(x.name="Nome da meta é obrigatório"),(isNaN(k)||k<=0)&&(x.target_amount="Valor alvo deve ser positivo"),o(x),Object.keys(x).length===0},R=()=>{const x={},k=parseFloat(d.amount);return(isNaN(k)||k<=0)&&(x.amount="Valor é obrigatório e deve ser positivo"),p(x),Object.keys(x).length===0},{data:L,isLoading:$,error:C}=I({queryKey:["personalGoals"],queryFn:async()=>{if(!a)throw new Error("Autenticação necessária.");const x=await fetch(`${ae}/api/personal-goals`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!x.ok)throw new Error("Não foi possível buscar as metas pessoais.");return x.json()},enabled:!!a}),m=M({mutationFn:async x=>{if(!a)throw new Error("Autenticação necessária.");const k=await fetch(`${ae}/api/personal-goals`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({...x,target_amount:parseFloat(x.target_amount),current_amount:0})});if(!k.ok){const V=await k.json();throw new Error(V.error||"Não foi possível adicionar a meta.")}return k.json()},onSuccess:()=>{u.success("Meta pessoal adicionada com sucesso!"),s.invalidateQueries({queryKey:["personalGoals"]}),b(!1),n({name:"",target_amount:"0"}),o({})},onError:x=>{u.error(`Erro: ${x.message}`)}}),A=M({mutationFn:async({id:x,amount:k})=>{if(!a||!N)throw new Error("Autenticação necessária ou meta não selecionada.");const V=parseFloat(k),U=N.current_amount+V,re=await fetch(`${ae}/api/personal-goals/${x}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify({...N,current_amount:U})});if(!re.ok){const Pe=await re.json();throw new Error(Pe.error||"Não foi possível adicionar fundos.")}return re.json()},onSuccess:()=>{u.success("Fundos adicionados com sucesso!"),s.invalidateQueries({queryKey:["personalGoals"]}),v(!1),D(null),g({amount:"0"}),p({})},onError:x=>{u.error(`Erro: ${x.message}`)}}),f=M({mutationFn:async x=>{if(!a)throw new Error("Autenticação necessária.");if(!(await fetch(`${ae}/api/personal-goals/${x}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.access_token}`}})).ok)throw new Error("Não foi possível excluir a meta.")},onSuccess:()=>{u.success("Meta pessoal excluída com sucesso!"),s.invalidateQueries({queryKey:["personalGoals"]})},onError:x=>{u.error(`Erro: ${x.message}`)}}),t=x=>{x.preventDefault(),B()&&m.mutate(i)},c=x=>{x.preventDefault(),R()&&N&&A.mutate({id:N.id,amount:d.amount})},w=x=>{window.confirm("Tem certeza que deseja excluir esta meta?")&&f.mutate(x)};return $?e.jsx(F,{children:e.jsx("div",{className:"text-center py-8",children:"Carregando metas..."})}):C?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar metas: ",C.message]})}):e.jsx(F,{children:e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Minhas Metas Pessoais"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Crie e acompanhe suas caixinhas de investimento para realizar seus sonhos!"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8",children:[L?.map(x=>{const k=x.current_amount/x.target_amount*100,V=k>=100?"bg-green-500":"bg-blue-500";return e.jsxs(S.div,{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 flex flex-col justify-between",whileHover:{scale:1.02},transition:{duration:.2},children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white mb-2",children:x.name}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["Alvo: ",e.jsx("span",{className:"font-bold",children:he(x.target_amount)})]}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:["Atual: ",e.jsx("span",{className:"font-bold",children:he(x.current_amount)})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mt-4",children:e.jsx("div",{className:`${V} h-2.5 rounded-full`,style:{width:`${Math.min(k,100)}%`}})}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:[k.toFixed(2),"% alcançado"]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>{D(x),v(!0),g({amount:"0"}),p({})},className:"p-2 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition duration-300",title:"Adicionar Fundos",children:e.jsx(be,{size:18})}),e.jsx("button",{onClick:()=>w(x.id),className:"p-2 rounded-full bg-red-100 text-red-600 hover:bg-red-200 transition duration-300",title:"Excluir Meta",children:e.jsx(ie,{size:18})})]})]},x.id)}),e.jsxs(S.button,{onClick:()=>{b(!0),n({name:"",target_amount:"0"}),o({})},className:"bg-gray-100 dark:bg-gray-700 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 flex flex-col items-center justify-center text-gray-500 dark:text-gray-300 hover:border-blue-500 hover:text-blue-500 transition duration-300",whileHover:{scale:1.02},transition:{duration:.2},children:[e.jsx(Oe,{size:36,className:"mb-2"}),e.jsx("span",{className:"text-lg font-semibold",children:"Adicionar Nova Meta"})]})]}),y&&e.jsx(W,{title:"Adicionar Nova Meta",isOpen:y,onClose:()=>b(!1),children:e.jsxs("form",{onSubmit:t,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome da Meta"}),e.jsx("input",{type:"text",id:"name",value:i.name,onChange:T,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),r.name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"target_amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Valor Alvo (R$)"}),e.jsx("input",{type:"number",id:"target_amount",value:i.target_amount,onChange:T,step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),r.target_amount&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:r.target_amount})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>b(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:m.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:m.isPending?"Adicionando...":"Adicionar Meta"})]})]})}),j&&N&&e.jsx(W,{title:`Adicionar Fundos a ${N.name}`,isOpen:j,onClose:()=>v(!1),children:e.jsxs("form",{onSubmit:c,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Valor a Adicionar (R$)"}),e.jsx("input",{type:"number",id:"amount",value:d.amount,onChange:O,step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.amount&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.amount})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>v(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:A.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:A.isPending?"Adicionando...":"Adicionar"})]})]})})]})})}const te="http://localhost:3001",Sa=a=>`R$ ${a.toFixed(2).replace(".",",")}`,Ea=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"short",year:"numeric"});function _a(){const{session:a}=z(),s=ee(),[i,n]=h.useState(!1),[r,o]=h.useState(null),[d,g]=h.useState({type:"expense",amount:0,category_id:"",description:"",date:""}),[l,p]=h.useState({}),y=m=>{const{id:A,value:f}=m.target;g(t=>({...t,[A]:A==="amount"?parseFloat(f):f})),p(t=>({...t,[A]:void 0}))},b=()=>{const m={};return d.type||(m.type="O tipo é obrigatório"),(!d.amount||isNaN(d.amount)||d.amount<=0)&&(m.amount="O valor deve ser positivo"),d.category_id||(m.category_id="A categoria é obrigatória"),d.date||(m.date="A data é obrigatória"),p(m),Object.keys(m).length===0},{data:j,isLoading:v,error:N}=I({queryKey:["scheduledTransactions"],queryFn:async()=>{if(!a)throw new Error("Autenticação necessária.");const m=await fetch(`${te}/api/scheduled-transactions?select=*,categories(name)`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!m.ok)throw new Error("Não foi possível buscar as transações agendadas.");return m.json()},enabled:!!a}),{data:D,isLoading:T,error:O}=I({queryKey:["categories"],queryFn:async()=>{if(!a)return[];const m=await fetch(`${te}/api/categories`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!m.ok)throw new Error("Não foi possível buscar as categorias.");return m.json()},enabled:!!a}),B=M({mutationFn:async m=>{if(!a||!r)throw new Error("Autenticação necessária ou transação não selecionada.");const A=await fetch(`${te}/api/scheduled-transactions/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a.access_token}`},body:JSON.stringify(m)});if(!A.ok){const f=await A.json();throw new Error(f.error||"Não foi possível atualizar a transação.")}return A.json()},onSuccess:()=>{u.success("Transação agendada atualizada com sucesso!"),s.invalidateQueries({queryKey:["scheduledTransactions"]}),n(!1),o(null)},onError:m=>{u.error(`Erro: ${m.message}`)}}),R=M({mutationFn:async m=>{if(!a)throw new Error("Autenticação necessária.");if(!(await fetch(`${te}/api/scheduled-transactions/${m}`,{method:"DELETE",headers:{Authorization:`Bearer ${a.access_token}`}})).ok)throw new Error("Não foi possível excluir a transação agendada.")},onSuccess:()=>{u.success("Transação agendada excluída com sucesso!"),s.invalidateQueries({queryKey:["scheduledTransactions"]})},onError:m=>{u.error(`Erro: ${m.message}`)}}),L=m=>{o(m),g({type:m.type,amount:m.amount,category_id:m.category_id,description:m.description||"",date:m.date.split("T")[0]}),p({}),n(!0)},$=m=>{m.preventDefault(),b()&&B.mutate(d)},C=m=>{window.confirm("Tem certeza que deseja excluir esta transação agendada?")&&R.mutate(m)};return v?e.jsx(F,{children:e.jsx("div",{className:"text-center py-8",children:"Carregando transações agendadas..."})}):N?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar transações: ",N.message]})}):e.jsx(F,{children:e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Transações Agendadas"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Gerencie suas despesas e receitas futuras."})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6",children:j&&j.length>0?e.jsx("div",{className:"space-y-4",children:j.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-3 rounded-full ${m.type==="income"?"bg-green-100 text-green-600":"bg-red-100 text-red-600"}`,children:e.jsx(Re,{})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gray-800 dark:text-white",children:m.description||"Transação Agendada"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m.categories?.name||"Sem Categoria"," • ",Ea(m.date)]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:`font-bold ${m.type==="income"?"text-green-500":"text-red-500"}`,children:[m.type==="expense"?"-":"+",Sa(m.amount)]}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 text-gray-400 mt-1",children:[e.jsx("button",{onClick:()=>L(m),className:"hover:text-blue-600",title:"Editar Transação",children:e.jsx(oe,{size:18})}),e.jsx("button",{onClick:()=>C(m.id),className:"hover:text-red-600",title:"Excluir Transação",children:e.jsx(ie,{size:18})})]})]})]},m.id))}):e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 py-8",children:"Nenhuma transação agendada encontrada."})}),i&&r&&e.jsx(W,{title:"Editar Transação Agendada",isOpen:i,onClose:()=>n(!1),children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"type",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Tipo"}),e.jsxs("select",{id:"type",value:d.type,onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:[e.jsx("option",{value:"income",children:"Entrada"}),e.jsx("option",{value:"expense",children:"Saída"})]}),l.type&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.type})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Valor (R$)"}),e.jsx("input",{type:"number",id:"amount",value:d.amount,onChange:y,step:"0.01",className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.amount&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.amount})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Categoria"}),e.jsx("select",{id:"category_id",value:d.category_id,onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",children:T?e.jsx("option",{children:"Carregando categorias..."}):O?e.jsx("option",{children:"Erro ao carregar categorias"}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),D?.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})}),l.category_id&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.category_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Descrição (Opcional)"}),e.jsx("textarea",{id:"description",value:d.description,onChange:y,rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Data"}),e.jsx("input",{type:"date",id:"date",value:d.date,onChange:y,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"}),l.date&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:l.date})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 rounded-md border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:B.isPending,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50",children:B.isPending?"Atualizando...":"Atualizar Transação"})]})]})})]})})}const Q="http://localhost:3001",Fa=K().shape({full_name:_().required("Nome completo é obrigatório")}),Aa=K().shape({new_password:_().min(8,"A senha deve ter no mínimo 8 caracteres").required("Nova senha é obrigatória"),confirm_password:_().oneOf([_e("new_password")],"As senhas não coincidem").required("Confirmação de senha é obrigatória")}),$a=K().shape({partner_email:_().email("Email inválido").required("Email do parceiro é obrigatório")}),se=({title:a,children:s,icon:i})=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-6 transition-transform duration-300 hover:scale-105 hover:shadow-2xl",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[i,e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white ml-2",children:a})]}),e.jsx("div",{className:"space-y-4",children:s})]}),Z=({id:a,label:s,...i})=>e.jsxs("div",{children:[e.jsx("label",{htmlFor:a,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:s}),e.jsx("input",{id:a,...i,className:"input w-full py-2 px-3 rounded-xl dark:bg-gray-700 dark:border-gray-600 dark:text-white disabled:bg-gray-200 disabled:dark:bg-gray-600"})]}),Pa=()=>{const{user:a,session:s,loading:i}=z(),n=ee(),[r,o]=h.useState(!1),[d,g]=h.useState(null),{data:l,isLoading:p,error:y}=I({queryKey:["profile",a?.id],queryFn:async()=>{if(!s)throw new Error("Autenticação necessária.");const t=await fetch(`${Q}/api/profile`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!t.ok)throw new Error("Não foi possível buscar o perfil.");return t.json()},enabled:!!s&&!!a?.id}),{data:b=[]}=I({queryKey:["coupleRelationships",a?.id],queryFn:async()=>{if(!s)return[];const t=await fetch(`${Q}/api/couple-relationships`,{headers:{Authorization:`Bearer ${s.access_token}`}});if(!t.ok)throw new Error("Não foi possível buscar os relacionamentos.");return t.json()},enabled:!!s&&!!a?.id}),j=b.find(t=>t.status==="accepted"),v=b.find(t=>t.status==="pending"&&t.user1_id===a?.id),N=b.filter(t=>t.status==="pending"&&t.user2_id===a?.id),D=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");const c=await fetch(`${Q}/api/couple-relationships/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({partner_email:t.partner_email})});if(!c.ok){const w=await c.json();throw new Error(w.error||"Não foi possível enviar o pedido.")}return c.json()},onSuccess:()=>{u.success("Pedido de conexão enviado!"),n.invalidateQueries({queryKey:["coupleRelationships"]}),m.resetForm()},onError:t=>u.error(t.message)}),T=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");const c=await fetch(`${Q}/api/couple-relationships/${t}/accept`,{method:"PUT",headers:{Authorization:`Bearer ${s.access_token}`}});if(!c.ok){const w=await c.json();throw new Error(w.error||"Não foi possível aceitar o pedido.")}return c.json()},onSuccess:()=>{u.success("Pedido de conexão aceito!"),n.invalidateQueries({queryKey:["coupleRelationships"]})},onError:t=>u.error(t.message)}),O=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");const c=await fetch(`${Q}/api/couple-relationships/${t}/reject`,{method:"PUT",headers:{Authorization:`Bearer ${s.access_token}`}});if(!c.ok){const w=await c.json();throw new Error(w.error||"Não foi possível rejeitar o pedido.")}return c.json()},onSuccess:()=>{u.success("Pedido de conexão rejeitado."),n.invalidateQueries({queryKey:["coupleRelationships"]})},onError:t=>u.error(t.message)}),B=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");await fetch(`${Q}/api/couple-relationships/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${s.access_token}`}})},onSuccess:()=>{u.success("Relacionamento removido."),n.invalidateQueries({queryKey:["coupleRelationships"]})},onError:t=>u.error(t.message)}),R=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");const c=await fetch(`${Q}/api/profile`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify(t)});if(!c.ok){const w=await c.json();throw new Error(w.error||"Não foi possível atualizar o perfil.")}return c.json()},onSuccess:()=>{u.success("Perfil atualizado!"),n.invalidateQueries({queryKey:["profile"]}),o(!1)},onError:t=>u.error(t.message)}),L=M({mutationFn:async t=>{if(!s)throw new Error("Autenticação necessária.");const c=await fetch(`${Q}/api/auth/reset-password`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s.access_token}`},body:JSON.stringify({new_password:t.new_password})});if(!c.ok){const w=await c.json();throw new Error(w.error||"Não foi possível redefinir a senha.")}return c.json()},onSuccess:()=>{u.success("Senha redefinida com sucesso!"),C.resetForm()},onError:t=>u.error(t.message)}),$=G({initialValues:{full_name:""},validationSchema:Fa,onSubmit:t=>R.mutate(t)}),C=G({initialValues:{new_password:"",confirm_password:""},validationSchema:Aa,onSubmit:t=>L.mutate(t)}),m=G({initialValues:{partner_email:""},validationSchema:$a,onSubmit:t=>D.mutate(t)});h.useEffect(()=>{l&&($.setValues({full_name:l.full_name||""}),g(l.avatar_url||null))},[l,$]);const A=async t=>{if(!t.target.files||t.target.files.length===0||!a)return;const c=t.target.files[0],w=`${a.id}/${Math.random()}.${c.name.split(".").pop()}`;try{const{error:x}=await E.storage.from("avatars").upload(w,c);if(x)throw x;const{data:{publicUrl:k}}=E.storage.from("avatars").getPublicUrl(w);g(k),R.mutate({...$.values,avatar_url:k}),u.success("Avatar atualizado!")}catch(x){const k=x instanceof Error?x.message:String(x);u.error(`Erro no upload: ${k}`)}};if(i||p)return e.jsx(F,{children:e.jsx("div",{className:"text-center py-8",children:"Carregando..."})});if(y)return e.jsx(F,{children:e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro: ",y.message]})});const f=()=>{if(j){const t=j.user1_id===a?.id?j.user2_profile:j.user1_profile;return e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Conectado(a) com: ",e.jsx("span",{className:"font-semibold",children:t?.full_name||"Usuário"})]}),e.jsxs("button",{onClick:()=>B.mutate(j.id),disabled:B.isPending,className:"btn-danger flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(ie,{className:"mr-2"})," ",B.isPending?"...":"Desconectar"]})]})}return v?e.jsx("div",{className:"bg-gray-100 dark:bg-gray-700 p-4 rounded-md",children:e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Pedido de conexão pendente enviado."})}):e.jsxs("form",{onSubmit:m.handleSubmit,className:"space-y-4",children:[e.jsx(Z,{id:"partner_email",label:"Email do Parceiro",type:"email",...m.getFieldProps("partner_email")}),m.touched.partner_email&&m.errors.partner_email&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:m.errors.partner_email}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{type:"submit",disabled:D.isPending,className:"btn-primary flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Le,{className:"mr-2"})," ",D.isPending?"Enviando...":"Enviar Pedido"]})})]})};return e.jsx(F,{children:e.jsxs("div",{className:"max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 space-y-8",children:[e.jsx(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white text-center",children:"Meu Perfil"})}),e.jsxs(se,{title:"Informações Pessoais",icon:e.jsx(ce,{className:"text-blue-500"}),children:[e.jsx("div",{className:"flex flex-col items-center mb-6",children:e.jsxs("div",{className:"relative w-48 h-48 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mb-4",children:[d?e.jsx("img",{src:d,alt:"Avatar",className:"w-full h-full object-cover"},d):e.jsx(ce,{className:"w-16 h-16 text-gray-500"}),e.jsxs("label",{htmlFor:"avatar_upload",className:"absolute bottom-0 right-0 bg-blue-500 text-white rounded-full w-10 h-10 flex items-center justify-center cursor-pointer hover:bg-blue-600 transition-transform transform hover:scale-110 z-50 transform translate-x-1/4 translate-y-1/4",children:[e.jsx(oe,{size:18}),e.jsx("input",{type:"file",id:"avatar_upload",accept:"image/*",onChange:A,className:"hidden"})]})]})}),e.jsxs("form",{onSubmit:$.handleSubmit,className:"space-y-4",children:[e.jsx(Z,{id:"full_name",label:"Nome Completo",type:"text",...$.getFieldProps("full_name"),disabled:!r}),$.touched.full_name&&$.errors.full_name&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:$.errors.full_name}),e.jsx(Z,{id:"email",label:"Email",type:"email",value:a?.email||"",disabled:!0}),e.jsx("div",{className:"flex justify-end space-x-4 mt-6",children:r?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",onClick:()=>o(!1),className:"btn-secondary flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-gray-300 hover:bg-gray-400 text-gray-800",children:[e.jsx(me,{className:"mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",disabled:R.isPending,className:"btn-primary flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(qe,{className:"mr-2"}),R.isPending?"Salvando...":"Salvar"]})]}):e.jsxs("button",{type:"button",onClick:()=>o(!0),className:"btn-secondary flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-gray-300 hover:bg-gray-400 text-gray-800",children:[e.jsx(oe,{className:"mr-2"}),"Editar Perfil"]})})]})]}),e.jsx(se,{title:"Segurança",icon:e.jsx(Me,{className:"text-purple-500"}),children:e.jsxs("form",{onSubmit:C.handleSubmit,className:"space-y-4",children:[e.jsx(Z,{id:"new_password",label:"Nova Senha",type:"password",...C.getFieldProps("new_password")}),C.touched.new_password&&C.errors.new_password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.errors.new_password}),e.jsx(Z,{id:"confirm_password",label:"Confirmar Nova Senha",type:"password",...C.getFieldProps("confirm_password")}),C.touched.confirm_password&&C.errors.confirm_password&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:C.errors.confirm_password}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:L.isPending,className:"btn-primary px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-blue-600 hover:bg-blue-700 text-white",children:L.isPending?"Redefinindo...":"Redefinir Senha"})})]})}),e.jsxs(se,{title:"Gerenciar Parceiro",icon:e.jsx(fe,{className:"text-green-500"}),children:[e.jsx(f,{}),N.length>0&&e.jsxs("div",{className:"mt-6 space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Pedidos Recebidos"}),e.jsx("ul",{className:"space-y-2",children:N.map(t=>e.jsxs("li",{className:"bg-gray-100 dark:bg-gray-700 p-3 rounded-md flex items-center justify-between",children:[e.jsxs("p",{children:["De: ",e.jsx("span",{className:"font-semibold",children:t.user1_profile?.full_name||"Usuário"})]}),e.jsxs("div",{className:"space-x-2",children:[e.jsxs("button",{onClick:()=>T.mutate(t.id),disabled:T.isPending,className:"btn-success flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ze,{className:"mr-1"}),"Aceitar"]}),e.jsxs("button",{onClick:()=>O.mutate(t.id),disabled:O.isPending,className:"btn-danger flex items-center px-4 py-2 rounded-lg transition-transform hover:scale-105 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(me,{className:"mr-1"}),"Rejeitar"]})]})]},t.id))})]})]})]})})},ge="http://localhost:3001",$e=a=>`R$ ${a.toFixed(2).replace(".",",")}`,pe=({title:a,amount:s,color:i,icon:n,animate:r})=>e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md flex flex-col justify-between ${r?"animate-pulse":""}`,children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-500",children:a}),e.jsx("div",{className:`text-2xl ${i}`,children:n})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-800 dark:text-white my-2",children:$e(s)})]}),Da=({data:a})=>{const{theme:s}=le(),i=h.useMemo(()=>{const d=a.reduce((g,l)=>{const p=new Date(l.date).toLocaleString("pt-BR",{month:"short",year:"numeric",timeZone:"UTC"});return g[p]||(g[p]={name:p,Receitas:0,Despesas:0}),l.type==="income"?g[p].Receitas+=l.amount:g[p].Despesas+=l.amount,g},{});return Object.values(d).reverse()},[a]),n=s==="dark"?"#E5E7EB":"#6B7280",r=s==="dark"?"#1F2937":"#FFFFFF",o=s==="dark"?"#4B5563":"#DDDDDD";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md h-[400px]",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-white mb-4",children:"Balanço Mensal do Casal"}),e.jsx(ta,{width:"100%",height:"100%",children:e.jsxs(ra,{data:i,margin:{top:5,right:20,left:-20,bottom:40},children:[e.jsx(sa,{strokeDasharray:"3 3",vertical:!1,stroke:s==="dark"?"#4B5563":"#E5E7EB"}),e.jsx(oa,{dataKey:"name",stroke:n}),e.jsx(na,{stroke:n,tickFormatter:d=>`R${d/1e3}k`}),e.jsx(ia,{cursor:{fill:"rgba(128, 128, 128, 0.1)"},contentStyle:{backgroundColor:r,border:`1px solid ${o}`,borderRadius:"0.5rem"}}),e.jsx(da,{wrapperStyle:{color:n}}),e.jsx(xe,{dataKey:"Receitas",fill:"#34D399",name:"Receitas",radius:[4,4,0,0]}),e.jsx(xe,{dataKey:"Despesas",fill:"#F87171",name:"Despesas",radius:[4,4,0,0]})]})})]})};function Ta(){const{session:a,user:s,loading:i}=z(),{data:n,isLoading:r}=I({queryKey:["coupleRelationship",s?.id,"accepted"],queryFn:async()=>{if(!a)return null;const b=await fetch(`${ge}/api/couple-relationships`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!b.ok)throw new Error("Não foi possível buscar o relacionamento.");const j=await b.json();return console.log("Fetched couple relationships:",j),j.find(N=>N.status==="accepted"&&(N.user1_id===s?.id||N.user2_id===s?.id))||null},enabled:!!a&&!!s?.id}),o=!!n,{data:d=[],isLoading:g,error:l}=I({queryKey:["transactions","couple",s?.id],queryFn:async()=>{if(!a||!o)return[];const b=await fetch(`${ge}/api/transactions?scope=couple`,{headers:{Authorization:`Bearer ${a.access_token}`}});if(!b.ok){const v=await b.json();throw new Error(v.error||"Failed to fetch transactions")}const j=(await b.json()).sort((v,N)=>new Date(N.created_at).getTime()-new Date(v.created_at).getTime());return console.log("Fetched couple transactions:",j),j},enabled:!!a&&o}),p=i||r||o&&g;h.useEffect(()=>{l&&u.error(l.message)},[l]);const y=h.useMemo(()=>d.reduce((b,j)=>(j.type==="income"?b.income+=j.amount:b.expense+=j.amount,b),{income:0,expense:0}),[d]);return p?e.jsx(F,{children:e.jsx("div",{className:"w-full h-screen flex items-center justify-center",children:"Carregando dashboard do casal..."})}):o?l?e.jsx(F,{children:e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar transações do casal: ",l.message]})}):e.jsx(F,{children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Dashboard do Casal"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Visão consolidada das finanças de vocês dois."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 my-8",children:[e.jsx(pe,{title:"Receita Total do Casal",amount:y.income,color:"text-green-500",icon:e.jsx(ye,{})}),e.jsx(pe,{title:"Despesa Total do Casal",amount:y.expense,color:"text-red-500",icon:e.jsx(Ie,{})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl p-6 shadow-md flex flex-col justify-center items-center text-center",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-500",children:"Saldo Atual do Casal"}),e.jsx("p",{className:`text-4xl font-bold my-2 ${y.income-y.expense>=0?"text-green-500":"text-red-500"}`,children:$e(y.income-y.expense)}),e.jsx("p",{className:"text-sm text-gray-400",children:"Balanço de todas as transações do casal"})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsx("div",{className:"lg:col-span-1 space-y-6",children:d.length>0?e.jsx(Da,{data:d}):e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-2xl shadow-md h-[400px] flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Nenhuma transação encontrada para o casal."})})})})]})}):e.jsx(F,{children:e.jsxs("div",{className:"text-center py-20",children:[e.jsx(fe,{className:"mx-auto text-6xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:"Conecte-se com seu parceiro(a)"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2 mb-6",children:"Para visualizar o dashboard do casal, você precisa estar conectado com seu parceiro(a)."}),e.jsx(P,{to:"/perfil",children:e.jsx("button",{className:"bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors",children:"Ir para a página de perfil para conectar"})})]})})}const H=({icon:a,title:s,children:i})=>e.jsxs(S.div,{className:"bg-gray-800 p-8 rounded-xl shadow-lg hover:shadow-indigo-500/20 transform hover:-translate-y-2 transition-all duration-300",variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.6}}},children:[e.jsx("div",{className:"text-indigo-400 mb-4 text-4xl",children:a}),e.jsx("h3",{className:"text-2xl font-bold mb-3 text-white",children:s}),e.jsx("p",{className:"text-gray-400",children:i})]}),Ba=()=>{const{session:a,loading:s}=z(),i=X();h.useEffect(()=>{!s&&a&&i("/dashboard")},[a,s,i]);const n={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.2,duration:.5}}},r={hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.6}}};return e.jsxs(S.div,{className:"min-h-screen bg-gray-900 text-white font-sans",initial:"hidden",animate:"visible",variants:n,children:[e.jsx("nav",{className:"fixed top-0 left-0 right-0 bg-gray-900/80 backdrop-blur-sm z-50 border-b border-gray-800",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-20",children:[e.jsxs(P,{to:"/",className:"flex items-center text-3xl font-bold text-white",children:[e.jsx(be,{className:"text-indigo-400 mr-2"}),"Nós",e.jsx("span",{className:"text-indigo-400",children:"Dois"})]}),e.jsx("div",{className:"hidden md:block",children:e.jsxs("div",{className:"ml-10 flex items-baseline space-x-4",children:[e.jsx("a",{href:"#features",className:"text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors",children:"Recursos"}),e.jsx("a",{href:"#cta",className:"text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition-colors",children:"Comece Agora"}),e.jsx(P,{to:"/login",className:"text-gray-300 bg-gray-800 hover:bg-gray-700 hover:text-white px-4 py-2 rounded-md text-sm font-bold transition-colors",children:"Login"}),e.jsx(P,{to:"/register",className:"bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-md text-sm transition-transform transform hover:scale-105 shadow-lg",children:"Criar Conta"})]})})]})})}),e.jsx("section",{className:"h-screen flex items-center justify-center text-center bg-cover bg-center",style:{backgroundImage:"linear-gradient(to bottom, rgba(17, 24, 39, 0.9), rgba(17, 24, 39, 1)), url('https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&w=1350&q=80')"},children:e.jsxs("div",{className:"relative z-10 p-8 max-w-4xl mx-auto",children:[e.jsx(S.h1,{className:"text-6xl md:text-8xl font-extrabold leading-tight mb-8 text-white drop-shadow-xl",variants:r,children:"Transforme sua Vida Financeira em Casal"}),e.jsx(S.p,{className:"text-xl md:text-3xl text-gray-300 mb-12 max-w-3xl mx-auto",variants:r,children:"Com o NósDois, vocês organizam despesas, alcançam metas e constroem um futuro próspero juntos. Simples, inteligente e sincronizado."}),e.jsx(S.div,{variants:r,children:e.jsx(P,{to:"/register",className:"bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-10 rounded-full text-lg transition-transform transform hover:scale-105 shadow-2xl",children:"Começar Gratuitamente"})})]})}),e.jsx("section",{id:"features",className:"py-24 bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx(S.h2,{className:"text-5xl font-bold mb-6 text-indigo-400",variants:r,children:"Tudo que vocês precisam em um só lugar"}),e.jsx(S.p,{className:"text-xl text-gray-400 mb-20 max-w-4xl mx-auto",variants:r,children:"Ferramentas poderosas para um controle financeiro descomplicado e eficiente, pensado para a vida a dois."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10",children:[e.jsx(H,{icon:e.jsx(Ve,{}),title:"Gestão de Despesas",children:"Adicionem e categorizem despesas e receitas em segundos. Vejam para onde o dinheiro está indo em tempo real."}),e.jsx(H,{icon:e.jsx(Ue,{}),title:"Relatórios Inteligentes",children:"Gráficos e relatórios claros que ajudam a entender seus hábitos financeiros e a tomar decisões melhores."}),e.jsx(H,{icon:e.jsx(ye,{}),title:"Metas em Comum",children:"Definam objetivos financeiros, como uma viagem ou a compra de um imóvel, e acompanhem o progresso juntos."}),e.jsx(H,{icon:e.jsx(Ge,{}),title:"Categorias Flexíveis",children:"Crie categorias personalizadas que se adaptam ao estilo de vida e às necessidades de vocês."}),e.jsx(H,{icon:e.jsx(Ke,{}),title:"Visão Individual e Conjunta",children:"Mantenham despesas pessoais separadas, mas com uma visão clara do orçamento total do casal."}),e.jsx(H,{icon:e.jsx(Je,{}),title:"Segurança de Ponta",children:"Seus dados são protegidos com as melhores práticas de segurança. Fiquem tranquilos, suas finanças estão seguras."})]})]})}),e.jsx("section",{id:"testimonial",className:"py-24 bg-gray-800",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-8 text-center",children:[e.jsx(S.h2,{className:"text-4xl font-bold mb-6 text-white",variants:r,children:"O que nossos usuários dizem"}),e.jsxs(S.div,{variants:r,className:"bg-gray-900 p-8 rounded-xl shadow-lg",children:[e.jsx("p",{className:"text-xl text-gray-300 mb-6",children:'"O NósDois transformou a maneira como lidamos com o dinheiro. Agora, estamos mais alinhados e confiantes em nosso futuro financeiro."'}),e.jsx("p",{className:"text-indigo-400 font-bold",children:"- Ana e João"})]})]})}),e.jsx("section",{id:"cta",className:"py-24 bg-gray-900",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-8 text-center",children:[e.jsx(S.h2,{className:"text-5xl font-bold mb-8 text-white",variants:r,children:"Prontos para dar o próximo passo?"}),e.jsx(S.p,{className:"text-xl text-gray-300 mb-12",variants:r,children:"Junte-se a milhares de casais que estão construindo um futuro financeiro mais sólido e tranquilo."}),e.jsx(S.div,{variants:r,children:e.jsx(P,{to:"/register",className:"bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-4 px-10 rounded-full text-lg transition-transform transform hover:scale-105 shadow-2xl",children:"Crie sua conta gratuita agora"})})]})}),e.jsxs("footer",{className:"bg-gray-900 border-t border-gray-800 py-8 text-center text-gray-500",children:[e.jsxs("p",{children:["© ",new Date().getFullYear()," NósDois. Todos os direitos reservados."]}),e.jsxs("div",{className:"mt-4 space-x-6",children:[e.jsx(P,{to:"/privacy",className:"hover:text-indigo-400 transition-colors",children:"Política de Privacidade"}),e.jsx(P,{to:"/terms",className:"hover:text-indigo-400 transition-colors",children:"Termos de Uso"})]})]})]})},Oa=K().shape({email:_().email("Email inválido").required("Email é obrigatório"),password:_().required("Senha é obrigatória")}),Ra=()=>{const a=X(),s=G({initialValues:{email:"",password:""},validationSchema:Oa,onSubmit:async n=>{const{email:r,password:o}=n,{error:d}=await E.auth.signInWithPassword({email:r,password:o});d?u.error(d.message):(u.success("Login realizado com sucesso!"),a("/dashboard"))}}),i={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5}}};return e.jsxs("div",{className:"h-screen flex items-center justify-center bg-gray-100 dark:bg-gradient-to-br dark:from-purple-800 dark:to-indigo-900 p-4 sm:p-6 lg:p-8 relative overflow-hidden",children:[e.jsx("div",{className:"background-circle circle-1"}),e.jsx("div",{className:"background-circle circle-2"}),e.jsx("div",{className:"background-circle circle-3"}),e.jsxs(S.div,{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md md:max-w-lg border border-gray-200 dark:border-gray-700 z-10",variants:i,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-center text-gray-900 dark:text-white mb-2 sm:mb-4",children:"Bem-vindo(a) de volta!"}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-center text-gray-600 dark:text-gray-300 mb-6 sm:mb-8",children:"Acesse sua conta"}),e.jsxs("form",{onSubmit:s.handleSubmit,className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.values.email,onChange:s.handleChange,onBlur:s.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"seu@email.com"}),s.touched.email&&s.errors.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Senha"}),e.jsx("input",{type:"password",id:"password",name:"password",value:s.values.password,onChange:s.handleChange,onBlur:s.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"********"}),s.touched.password&&s.errors.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:s.errors.password}),e.jsx("div",{className:"text-right mt-2",children:e.jsx("button",{type:"button",onClick:async()=>{const n=s.values.email;if(!n){u.error("Por favor, insira seu email para redefinir a senha.");return}const{error:r}=await E.auth.resetPasswordForEmail(n,{redirectTo:`${window.location.origin}/update-password`});r?u.error(r.message):u.success("Verifique seu email para o link de redefinição de senha!")},className:"text-sm text-purple-600 dark:text-purple-400 hover:underline",children:"Esqueceu a senha?"})})]}),e.jsx("button",{type:"submit",disabled:s.isSubmitting,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:opacity-50 text-lg shadow-lg",style:{backgroundColor:"blue",color:"white",border:"2px solid red"},children:s.isSubmitting?"Entrando...":"Entrar"})]}),e.jsxs("p",{className:"text-center text-gray-600 dark:text-gray-400 mt-6 text-md",children:["Não tem uma conta? ",e.jsx(P,{to:"/register",className:"text-purple-600 dark:text-purple-400 hover:underline font-semibold",children:"Cadastre-se"})]})]})]})},qa=K().shape({name:_().required("Nome é obrigatório"),email:_().email("Email inválido").required("Email é obrigatório"),password:_().min(8,"A senha deve ter no mínimo 8 caracteres").matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/,"A senha precisa conter maiúscula, minúscula, número e caractere especial").required("Senha é obrigatória"),terms:la().oneOf([!0],"Você deve aceitar os termos de uso")}),Ma=()=>{const a=X(),[s,i]=h.useState(""),[n,r]=h.useState(""),[o,d]=h.useState(!1),g=async y=>{const b=y==="terms"?"/TERMS_OF_USE.md":"/PRIVACY_POLICY.md",j=y==="terms"?"Termos de Uso":"Política de Privacidade";try{const N=await(await fetch(b)).text();i(N),r(j),d(!0)}catch(v){console.error("Failed to fetch document:",v),u.error("Não foi possível carregar o documento.")}},l=G({initialValues:{name:"",email:"",password:"",terms:!1},validationSchema:qa,onSubmit:async y=>{const{name:b,email:j,password:v}=y,{error:N}=await E.auth.signUp({email:j,password:v,options:{data:{full_name:b}}});N?N.message.includes("User already registered")?u.error("Este e-mail já está em uso. Tente fazer login."):u.error(N.message):(u.success("Cadastro realizado! Verifique seu e-mail para confirmar a conta."),a("/dashboard"))}}),p={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gradient-to-br dark:from-purple-800 dark:to-indigo-900 p-4",children:e.jsxs(S.div,{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700",variants:p,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-4xl font-bold text-center text-gray-900 dark:text-white mb-4",children:"Crie sua conta"}),e.jsx("h3",{className:"text-xl font-semibold text-center text-gray-600 dark:text-gray-300 mb-8",children:"Comece a controlar suas finanças hoje!"}),e.jsxs("form",{onSubmit:l.handleSubmit,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Nome"}),e.jsx("input",{type:"text",id:"name",name:"name",value:l.values.name,onChange:l.handleChange,onBlur:l.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"Seu nome completo"}),l.touched.name&&l.errors.name&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:l.values.email,onChange:l.handleChange,onBlur:l.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"seu@email.com"}),l.touched.email&&l.errors.email&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Senha"}),e.jsx("input",{type:"password",id:"password",name:"password",value:l.values.password,onChange:l.handleChange,onBlur:l.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"Crie uma senha forte"}),l.touched.password&&l.errors.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.password})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"terms",name:"terms",checked:l.values.terms,onChange:l.handleChange,onBlur:l.handleBlur,className:"h-4 w-4 text-purple-600 focus:ring-purple-500 border-gray-300 rounded"}),e.jsxs("label",{htmlFor:"terms",className:"ml-2 block text-sm text-gray-900 dark:text-gray-300",children:["Eu li e aceito os"," ",e.jsx("button",{type:"button",onClick:()=>g("terms"),className:"font-medium text-purple-600 hover:text-purple-500",children:"Termos de Uso"})," e a ",e.jsx("button",{type:"button",onClick:()=>g("privacy"),className:"font-medium text-purple-600 hover:text-purple-500",children:"Política de Privacidade"}),"."]})]}),l.touched.terms&&l.errors.terms&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l.errors.terms}),e.jsx("button",{type:"submit",disabled:l.isSubmitting||!l.values.terms,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:opacity-50 text-lg shadow-lg",children:l.isSubmitting?"Cadastrando...":"Cadastrar"})]}),e.jsxs("p",{className:"text-center text-gray-600 dark:text-gray-400 mt-6 text-md",children:["Já tem uma conta? ",e.jsx(P,{to:"/login",className:"text-purple-600 dark:text-purple-400 hover:underline font-semibold",children:"Faça login"})]})]})}),e.jsx(W,{title:n,isOpen:o,onClose:()=>d(!1),children:e.jsx("div",{className:"prose dark:prose-invert max-h-96 overflow-y-auto",children:e.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:s})})})]})},za=K().shape({category_id:_().uuid("Selecione uma categoria válida").required("Categoria é obrigatória"),budget_amount:de().positive("O valor do orçamento deve ser positivo").required("Valor é obrigatório"),start_date:_().required("Data de início é obrigatória"),end_date:_().required("Data de fim é obrigatória")}),La=({onBudgetCreated:a})=>{const{supabase:s}=z(),[i,n]=ne.useState([]);ne.useEffect(()=>{(async()=>{if(!s)return;const{data:d,error:g}=await s.from("categories").select("id, name");g?(console.error("Error fetching categories:",g.message),u.error("Erro ao buscar categorias.")):n(d||[])})()},[s]);const r=G({initialValues:{category_id:"",budget_amount:"",start_date:"",end_date:""},validationSchema:za,onSubmit:async(o,{resetForm:d})=>{if(!s)return;const{error:g}=await s.from("budgets").insert(o).select().single();g?(console.error("Error creating budget:",g.message),u.error("Erro ao criar orçamento.")):(u.success("Orçamento criado com sucesso!"),a(),d())}});return e.jsxs("form",{onSubmit:r.handleSubmit,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"category_id",className:"block text-gray-300 text-sm font-bold mb-2",children:"Categoria"}),e.jsxs("select",{id:"category_id",name:"category_id",onChange:r.handleChange,onBlur:r.handleBlur,value:r.values.category_id,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[e.jsx("option",{value:"",children:"Selecione uma categoria"}),i.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))]}),r.touched.category_id&&r.errors.category_id&&e.jsx("p",{className:"text-red-500 text-xs italic",children:r.errors.category_id})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"budget_amount",className:"block text-gray-300 text-sm font-bold mb-2",children:"Valor do Orçamento"}),e.jsx("input",{type:"number",id:"budget_amount",name:"budget_amount",onChange:r.handleChange,onBlur:r.handleBlur,value:r.values.budget_amount,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",placeholder:"Ex: 500.00"}),r.touched.budget_amount&&r.errors.budget_amount&&e.jsx("p",{className:"text-red-500 text-xs italic",children:r.errors.budget_amount})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_date",className:"block text-gray-300 text-sm font-bold mb-2",children:"Data de Início"}),e.jsx("input",{type:"date",id:"start_date",name:"start_date",onChange:r.handleChange,onBlur:r.handleBlur,value:r.values.start_date,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"}),r.touched.start_date&&r.errors.start_date&&e.jsx("p",{className:"text-red-500 text-xs italic",children:r.errors.start_date})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"end_date",className:"block text-gray-300 text-sm font-bold mb-2",children:"Data de Fim"}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",onChange:r.handleChange,onBlur:r.handleBlur,value:r.values.end_date,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"}),r.touched.end_date&&r.errors.end_date&&e.jsx("p",{className:"text-red-500 text-xs italic",children:r.errors.end_date})]}),e.jsx("button",{type:"submit",className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",disabled:r.isSubmitting,children:r.isSubmitting?"Criando...":"Criar Orçamento"})]})},Ia=({budget:a,onBudgetDeleted:s})=>{const{supabase:i}=z(),[n,r]=h.useState("Carregando..."),[o,d]=h.useState(0),[g,l]=h.useState(!0);h.useEffect(()=>{(async()=>{if(!i)return;const{data:v,error:N}=await i.from("categories").select("name").eq("id",a.category_id).single();N?(console.error("Error fetching category name:",N.message),r("Desconhecida")):r(v?.name||"Desconhecida")})()},[a.category_id,i]),h.useEffect(()=>{(async()=>{if(!i||n==="Carregando..."||n==="Desconhecida")return;l(!0);const{data:v,error:N}=await i.from("transactions").select("amount").eq("user_id",a.user_id).eq("category_id",a.category_id).gte("date",a.start_date).lte("date",a.end_date);if(N)console.error("Error fetching current spend:",N.message),u.error("Erro ao calcular gastos atuais.");else{const D=v?.reduce((T,O)=>T+O.amount,0)||0;d(D)}l(!1)})()},[a.category_id,a.user_id,a.start_date,a.end_date,i,n]),h.useEffect(()=>{const j=`budget_exceeded_${a.id}`,v=sessionStorage.getItem(j);!g&&o>a.budget_amount&&!v&&(u.error(`Orçamento de ${n} excedido! Gasto: R$ ${o.toFixed(2)} de R$ ${a.budget_amount.toFixed(2)}`),sessionStorage.setItem(j,"true"))},[o,a.budget_amount,g,n,a.id]);const p=async()=>{if(!i)return;const{error:j}=await i.from("budgets").delete().eq("id",a.id);j?(console.error("Error deleting budget:",j.message),u.error("Erro ao deletar orçamento.")):(u.success("Orçamento deletado com sucesso!"),s())},y=o/a.budget_amount*100,b=y<80?"bg-green-500":y<100?"bg-yellow-500":"bg-red-500";return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg text-white",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:n}),e.jsxs("p",{className:"text-gray-400",children:["Período: ",a.start_date," a ",a.end_date]}),e.jsxs("p",{className:"text-lg mt-2",children:["Orçamento: R$ ",a.budget_amount.toFixed(2)]}),e.jsxs("p",{className:"text-lg",children:["Gasto Atual: ",g?"Carregando...":`R$ ${o.toFixed(2)}`]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2.5 mt-4",children:e.jsx("div",{className:`${b} h-2.5 rounded-full`,style:{width:`${Math.min(100,y)}%`}})}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:[y.toFixed(2),"% do orçamento"]}),e.jsx("button",{onClick:p,className:"mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:"Deletar"})]})},Va=()=>{const{supabase:a}=z(),[s,i]=h.useState([]),[n,r]=h.useState(!0),o=h.useCallback(async()=>{if(!a)return;r(!0);const{data:l,error:p}=await a.from("budgets").select("*").order("start_date",{ascending:!1});p?(console.error("Error fetching budgets:",p.message),u.error("Erro ao buscar orçamentos.")):i(l||[]),r(!1)},[a]);h.useEffect(()=>{o()},[o]);const d=()=>{o()},g=()=>{o()};return n?e.jsx(F,{children:e.jsx("div",{className:"flex justify-center items-center h-full",children:e.jsx("p",{className:"text-white",children:"Carregando orçamentos..."})})}):e.jsx(F,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Meus Orçamentos"}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Criar Novo Orçamento"}),e.jsx(La,{onBudgetCreated:d})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.length===0?e.jsx("p",{className:"text-white col-span-full text-center",children:"Nenhum orçamento encontrado. Crie um novo!"}):s.map(l=>e.jsx(Ia,{budget:l,onBudgetDeleted:g},l.id))})]})})};we.register(ve,Ne,ke,Ce,Se,Ee,ca,ma);const Ua=()=>{const{supabase:a}=z(),[s,i]=h.useState({}),[n,r]=h.useState([]),[o,d]=h.useState([]),[g,l]=h.useState([]),[p,y]=h.useState(!0),[b,j]=h.useState(""),[v,N]=h.useState(""),D=h.useCallback(async()=>{if(!a)return;y(!0);let f="/api/reports/expenses-by-category";const t=new URLSearchParams;b&&t.append("startDate",b),v&&t.append("endDate",v),t.toString()&&(f=`${f}?${t.toString()}`);try{const{data:{session:c}}=await a.auth.getSession();if(!c)throw new Error("User not authenticated");const w=await fetch(f,{headers:{Authorization:`Bearer ${c.access_token}`}});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const x=await w.json();i(x)}catch(c){const w=c instanceof Error?c.message:String(c);console.error("Error fetching expenses by category:",w),u.error("Erro ao buscar despesas por categoria.")}finally{y(!1)}},[a,b,v]),T=h.useCallback(async()=>{if(!a)return;y(!0);let f="/api/reports/income-expense-over-time";const t=new URLSearchParams;b&&t.append("startDate",b),v&&t.append("endDate",v),t.toString()&&(f=`${f}?${t.toString()}`);try{const{data:{session:c}}=await a.auth.getSession();if(!c)throw new Error("User not authenticated");const w=await fetch(f,{headers:{Authorization:`Bearer ${c.access_token}`}});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const x=await w.json();r(x)}catch(c){const w=c instanceof Error?c.message:String(c);console.error("Error fetching income/expense over time:",w),u.error("Erro ao buscar dados de receita/despesa por tempo.")}finally{y(!1)}},[a,b,v]),O=h.useCallback(async()=>{if(!a)return;y(!0);let f="/api/reports/budget-vs-actual";const t=new URLSearchParams;b&&t.append("startDate",b),v&&t.append("endDate",v),t.toString()&&(f=`${f}?${t.toString()}`);try{const{data:{session:c}}=await a.auth.getSession();if(!c)throw new Error("User not authenticated");const w=await fetch(f,{headers:{Authorization:`Bearer ${c.access_token}`}});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const x=await w.json();d(x)}catch(c){const w=c instanceof Error?c.message:String(c);console.error("Error fetching budget vs actual:",w),u.error("Erro ao buscar relatório de orçamento vs. real.")}finally{y(!1)}},[a,b,v]),B=h.useCallback(async()=>{if(a){y(!0);try{const{data:{session:f}}=await a.auth.getSession();if(!f)throw new Error("User not authenticated");const{data:t,error:c}=await a.from("transactions").select("id, type, amount, date, description, category_id");if(c)throw c;const w=await fetch("/api/anomaly-detection",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${f.access_token}`},body:JSON.stringify({transactions:t})});if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);const x=await w.json();l(x.filter(k=>k.is_anomaly)),u.success("Detecção de anomalias concluída!")}catch(f){const t=f instanceof Error?f.message:String(f);console.error("Error running anomaly detection:",t),u.error("Erro ao executar detecção de anomalias.")}finally{y(!1)}}},[a]);h.useEffect(()=>{D(),T(),O()},[D,T,O]);const R={labels:Object.keys(s),datasets:[{label:"Despesas por Categoria",data:Object.values(s),backgroundColor:"rgba(255, 99, 132, 0.5)"}]},L={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Despesas por Categoria"}}},$={labels:n.map(f=>f.month),datasets:[{label:"Receita",data:n.map(f=>f.income),borderColor:"rgb(75, 192, 192)",backgroundColor:"rgba(75, 192, 192, 0.5)",tension:.1},{label:"Despesa",data:n.map(f=>f.expense),borderColor:"rgb(255, 99, 132)",backgroundColor:"rgba(255, 99, 132, 0.5)",tension:.1}]},C={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Receita vs. Despesa ao Longo do Tempo"}},scales:{y:{beginAtZero:!0}}},m={labels:o.map(f=>f.categoryName),datasets:[{label:"Orçado",data:o.map(f=>f.budgeted),backgroundColor:"rgba(54, 162, 235, 0.5)"},{label:"Real",data:o.map(f=>f.actual),backgroundColor:"rgba(255, 99, 132, 0.5)"}]},A={responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Orçamento vs. Real"}},scales:{y:{beginAtZero:!0}}};return e.jsx(F,{children:e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Relatórios Financeiros"}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Despesas por Categoria"}),e.jsxs("div",{className:"flex space-x-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-gray-300 text-sm font-bold mb-2",children:"Data de Início"}),e.jsx("input",{type:"date",id:"startDate",value:b,onChange:f=>j(f.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-gray-300 text-sm font-bold mb-2",children:"Data de Fim"}),e.jsx("input",{type:"date",id:"endDate",value:v,onChange:f=>N(f.target.value),className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]})]}),p?e.jsx("p",{className:"text-white",children:"Carregando dados do relatório..."}):Object.keys(s).length>0?e.jsx(ue,{data:R,options:L}):e.jsx("p",{className:"text-white",children:"Nenhum dado de despesa encontrado para o período selecionado."})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Receita vs. Despesa ao Longo do Tempo"}),p?e.jsx("p",{className:"text-white",children:"Carregando dados do relatório..."}):n.length>0?e.jsx(Qe,{data:$,options:C}):e.jsx("p",{className:"text-white",children:"Nenhum dado de receita ou despesa encontrado para o período selecionado."})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Orçamento vs. Real"}),p?e.jsx("p",{className:"text-white",children:"Carregando dados do relatório..."}):o.length>0?e.jsx(ue,{data:m,options:A}):e.jsx("p",{className:"text-white",children:"Nenhum dado de orçamento vs. real encontrado para o período selecionado."})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-lg shadow-lg mb-8",children:[e.jsx("h2",{className:"text-2xl font-semibold text-white mb-4",children:"Detecção de Anomalias"}),e.jsx("button",{onClick:B,disabled:p,className:"bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded mb-4 disabled:opacity-50",children:p?"Detectando...":"Executar Detecção de Anomalias"}),g.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-white",children:"Anomalias detectadas:"}),e.jsx("ul",{className:"list-disc list-inside text-white",children:g.map(f=>e.jsxs("li",{children:[f.description||"Transação"," de R$ ",f.amount," em ",new Date(f.date).toLocaleDateString()," (Score: ",f.anomaly_score,")"]},f.id))})]}):e.jsx("p",{className:"text-white",children:"Nenhuma anomalia detectada para o período selecionado."})]})]})})},Ga=K().shape({password:_().min(6,"A senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória"),confirmPassword:_().oneOf([_e("password"),void 0],"As senhas devem ser iguais").required("Confirmação de senha é obrigatória")}),Ka=()=>{const a=X(),[s,i]=h.useState(!1),n=G({initialValues:{password:"",confirmPassword:""},validationSchema:Ga,onSubmit:async o=>{i(!0);const{password:d}=o,{error:g}=await E.auth.updateUser({password:d});g?u.error(g.message):(u.success("Senha atualizada com sucesso!"),a("/dashboard")),i(!1)}}),r={hidden:{opacity:0,y:-20},visible:{opacity:1,y:0,transition:{duration:.5}}};return e.jsxs("div",{className:"h-screen flex items-center justify-center bg-gray-100 dark:bg-gradient-to-br dark:from-purple-800 dark:to-indigo-900 p-4 sm:p-6 lg:p-8 relative overflow-hidden",children:[e.jsx("div",{className:"background-circle circle-1"}),e.jsx("div",{className:"background-circle circle-2"}),e.jsx("div",{className:"background-circle circle-3"}),e.jsxs(S.div,{className:"bg-white dark:bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md md:max-w-lg border border-gray-200 dark:border-gray-700 z-10",variants:r,initial:"hidden",animate:"visible",children:[e.jsx("h2",{className:"text-3xl sm:text-4xl font-bold text-center text-gray-900 dark:text-white mb-2 sm:mb-4",children:"Redefinir Senha"}),e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-center text-gray-600 dark:text-gray-300 mb-6 sm:mb-8",children:"Insira sua nova senha"}),e.jsxs("form",{onSubmit:n.handleSubmit,className:"space-y-4 lg:space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Nova Senha"}),e.jsx("input",{type:"password",id:"password",name:"password",value:n.values.password,onChange:n.handleChange,onBlur:n.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"********"}),n.touched.password&&n.errors.password&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.errors.password})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-gray-600 dark:text-gray-400 mb-2 text-lg",children:"Confirmar Nova Senha"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:n.values.confirmPassword,onChange:n.handleChange,onBlur:n.handleBlur,className:"w-full px-4 py-3 bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400",placeholder:"********"}),n.touched.confirmPassword&&n.errors.confirmPassword&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:n.errors.confirmPassword})]}),e.jsx("button",{type:"submit",disabled:s,className:"w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:opacity-50 text-lg shadow-lg",children:s?"Redefinindo...":"Redefinir Senha"})]})]})]})},Y=({children:a})=>{const{session:s,loading:i}=z();return i?e.jsx("div",{className:"w-full h-screen flex items-center justify-center bg-gray-50",children:"Carregando..."}):s?e.jsx(e.Fragment,{children:a}):e.jsx(je,{to:"/login",replace:!0})};function Ja(){return h.useEffect(()=>{const a=E.channel("public:transactions").on("postgres_changes",{event:"INSERT",schema:"public",table:"transactions"},n=>{u.success(`Nova transação adicionada: ${n.new.description||"Sem descrição"} (R$ ${n.new.amount})`)}).subscribe(),s=E.channel("public:budgets").on("postgres_changes",{event:"INSERT",schema:"public",table:"budgets"},n=>{u(`Novo orçamento criado para ${n.new.category_id} (R$ ${n.new.budget_amount})`)}).subscribe(),i=E.channel("public:couple_relationships").on("postgres_changes",{event:"INSERT",schema:"public",table:"couple_relationships"},()=>{u("Novo pedido de conexão de casal recebido!")}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"couple_relationships"},n=>{n.new.status==="accepted"&&u.success("Pedido de conexão de casal aceito!")}).subscribe();return()=>{E.removeChannel(a),E.removeChannel(s),E.removeChannel(i)}},[]),e.jsx(Ye,{basename:"/",future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:e.jsxs(He,{children:[e.jsx(q,{path:"/",element:e.jsx(Ba,{})}),e.jsx(q,{path:"/login",element:e.jsx(Ra,{})}),e.jsx(q,{path:"/register",element:e.jsx(Ma,{})}),e.jsx(q,{path:"/update-password",element:e.jsx(Ka,{})}),e.jsx(q,{path:"/dashboard",element:e.jsx(Y,{children:e.jsx(va,{})})}),e.jsx(q,{path:"*",element:e.jsx(je,{to:"/"})}),e.jsx(q,{path:"/nova-transacao",element:e.jsx(Y,{children:e.jsx(ka,{})})}),e.jsx(q,{path:"/personal-goals",element:e.jsx(Y,{children:e.jsx(Ca,{})})}),e.jsx(q,{path:"/scheduled-transactions",element:e.jsx(Y,{children:e.jsx(_a,{})})}),e.jsx(q,{path:"/profile",element:e.jsx(Y,{children:e.jsx(Pa,{})})}),e.jsx(q,{path:"/couple-dashboard",element:e.jsx(Y,{children:e.jsx(Ta,{})})}),e.jsx(q,{path:"/budgets",element:e.jsx(Y,{children:e.jsx(Va,{})})}),e.jsx(q,{path:"/reports",element:e.jsx(Y,{children:e.jsx(Ua,{})})})]})})}const Qa=({children:a})=>{const[s,i]=h.useState(null),[n,r]=h.useState(null),[o,d]=h.useState(null),[g,l]=h.useState(!0);h.useEffect(()=>{(async()=>{const{data:{session:j},error:v}=await E.auth.getSession();v&&console.error("Error getting session:",v.message),i(j),r(j?.user??null),d(j?.user?.user_metadata?.full_name||null),l(!1)})();const{data:b}=E.auth.onAuthStateChange((j,v)=>{i(v),r(v?.user??null),d(v?.user?.user_metadata?.full_name||null),l(!1)});return()=>{b.subscription.unsubscribe()}},[]),h.useEffect(()=>{(async()=>{if(n&&!o){const{data:b,error:j}=await E.from("profiles").select("full_name").eq("id",n.id).single();j?console.error("Error fetching profile:",j.message):b&&d(b.full_name)}})()},[n,o]);const p={session:s,user:n,supabase:E,loading:g,fullName:o};return e.jsx(Fe.Provider,{value:p,children:a})},Ya=({children:a})=>{const[s,i]=h.useState(()=>localStorage.getItem("theme")||"light");h.useEffect(()=>{document.documentElement.setAttribute("data-theme",s),localStorage.setItem("theme",s)},[s]);const r={theme:s,toggleTheme:()=>{i(o=>o==="light"?"dark":"light")}};return e.jsx(Ae.Provider,{value:r,children:a})},Ha=new ua;Xe.createRoot(document.getElementById("root")).render(e.jsx(ne.StrictMode,{children:e.jsx(Ze,{client:Ha,children:e.jsx(Ya,{children:e.jsxs(Qa,{children:[e.jsx(Ja,{}),e.jsx(We,{position:"top-right",toastOptions:{success:{duration:1500}}})]})})})}));
